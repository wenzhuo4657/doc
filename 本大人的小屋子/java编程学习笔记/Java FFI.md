

# JNI


参考文档：[NDK 系列（5）：JNI 从入门到实践，万字爆肝详解！ - 掘金 (juejin.cn)](https://juejin.cn/post/7125338583959306248?searchId=202405241908002DB41CC60162B6137233#heading-17)


c/c++知识：
.h头文件：类似与java中的interface，提供一些字段、方法等的定义，其具体实现通常放在c/cpp文件内



# 编译示例：

java代码
```
package com.test;  
  
public class GetPidJni {  
  
public native static void set(int i);  
public native void set();  
  
public static void main(String[] args) {  
  
}  
  
}
```

目录结构
![image.png](http://obimage.wenzhuo4657.cn/20240523195023.png)


` javah -classpath E:\code\jni-jna-study\out\production\jni-jna-study com.test.GetPidJni   `


生成头文件如下
```
/* DO NOT EDIT THIS FILE - it is machine generated */  
#include <jni.h>  
/* Header for class com_test_GetPidJni */  
  
#ifndef _Included_com_test_GetPidJni  
#define _Included_com_test_GetPidJni  
#ifdef __cplusplus  
extern "C" {  
#endif  
/*  
* Class: com_test_GetPidJni  
* Method: set  
* Signature: (I)V  
*/  
JNIEXPORT void JNICALL Java_com_test_GetPidJni_set__I  
(JNIEnv *, jclass, jint);  
  
/*  
* Class: com_test_GetPidJni  
* Method: set  
* Signature: ()V  
*/  
JNIEXPORT void JNICALL Java_com_test_GetPidJni_set__  
(JNIEnv *, jobject);  
  
#ifdef __cplusplus  
}  
#endif  
#endif
```


*jint*:是以JNI为中介使JAVA的int类型与本地的int沟通的一种类型




使用工具将其编译为dll/so文件，并在java代码中引用，使用绝对地址

```
public class GetPidJni {  
static {  
System.load("E:\\code\\dll\\jni.dll");  
}  
  
  
public native static void set(int i);  
public native static int get();  
  
public static void main(String[] args) {  
set(3);  
System.out.println(get());  
  
}  
  
}
```


# 数据类型转换
## Java 类型映射


[JNI系列(四)JAVA数据类型和JNI类型对照表_jni 与 java 对应类型表-CSDN博客](https://blog.csdn.net/u011781521/article/details/106955363)


### 基本数据类型

基本数据类型在映射时是直接映射，而不会发生数据格式转换
且注意：
1，由于是基本类型存储在栈上，在作用域结束时自动消亡，不受gc影响
2，基本类型会将值直接复制传递，其存储和jvm毫无关系


![image.png](http://obimage.wenzhuo4657.cn/20240524191905.png)


### 引用数据类型
java对象在内存中不会转换为c/c++对象，仅提供指针操作

注意：
1，由于指向jvm虚拟机内部的数据结构，所以不可能在c/c++环境直接操作，而是需要依赖于JNIEnv 环境对象
2，为了避免对象在使用时突然被回收，在本地方法返回前，虚拟机会固定（pin）对象，阻止其 GC





# Panama